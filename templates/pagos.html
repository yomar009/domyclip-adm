<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <title>dashboard control</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
        integrity="sha512-xxxxxx" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&display=swap">

    <!--
    <link rel="stylesheet" href="styles.css">
    <link rel ="stylesheet" href="sidebar.css">
    <link rel ="stylesheet" href="header.css">
    <script src="Graficas.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
-->
    <link rel="stylesheet" href="{{ url_for('static', filename='Dashboard.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='header_sidebar.css') }}">
    <script src="{{ url_for('static', filename='Graficas.js') }}"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

</head>

<body>
    <header class="header">
        <!-- Menú lateral -->
        <div class="top-menu">
            <div class="Version">
                <h4>Dashboard de bienes raices</h4>
            </div>
            <div class="logo">
                <i class="fas fa-code"></i>
                <h3>DomyClip</h3>
            </div>
            <div class="icon">
                <i class="fas fa-user"></i>
                <h3>{{ session['username'] }}</h3>
            </div>
        </div>
    </header>

    <main class="main">
        <div class="circulo">
            <div class="titulo">
                <h1>Cuentas por Cobrar de {{ nombre_edificio }}</h1>
            </div>
            <div class="propietarios-section">
                <!-- Botones de bloque en la parte superior -->
                <div class="botones-bloque">
                    {% for bloque in bloques %}
                    <button class="bloque-btn" onclick="togglePropietarios({{ bloque }})">
                        <div class="icon-container">
                            <i class="fas fa-building"></i>
                        </div>
                        Bloque {{ bloque }}
                    </button>
                    {% endfor %}
                </div>
    
                <!-- Detalles de los propietarios -->
                {% for bloque, propietarios in propietarios_por_bloque.items() %}
                <div class="bloque" id="bloque{{ bloque }}" style="display: none;">
                    <div class="propietarios" id="propietarios{{ bloque }}">
                        <div class="row">
                            {% for propietario in propietarios %}
                            <div class="col-md-6">
                                <div class="prop">
                                    <div class="contenido">
                                        <div class="texto">
                                            <h3>Propietario: {{ propietario[1] }} {{ propietario[2] }}</h3>
                                            <p>Usuario ID: {{ propietario[0] }}</p>
                                            <p>Apartamento: {{ propietario[3] }}</p>
                                            <p>Bloque: {{ bloque }}</p>
                                            <p>Cuota fija de Administracion: {{ propietario[9] }}</p>
                                            <p>Cuota fija de Parqueadero: {{ propietario[10] }}</p>
                                            <p>Cuota extra: {{ propietario[11] }}</p>
                                        </div>
                                        <div class="cont_boton">
                                            <button class="boton" onclick="abrirModalEditarPropietario('{{ propietario[0] }}', '{{ propietario[9] }}', '{{ propietario[10] }}', '{{ propietario[11] }}')">
                                                <i class="fas fa-edit"></i> <!-- Icono de edición -->
                                                Editar
                                            </button>
                                                <!-- Agrega el botón de "Multa" -->
                                            <button class="boton" onclick="abrirModalAñadirMulta('{{ propietario[0] }}')">
                                                <i class="fas fa-plus"></i> <!-- Icono para añadir -->
                                                Multa
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}                            
                        </div>
                    </div>
                </div>
                {% endfor %}
                <!-- Botón para buscar propietario y abrir el modal -->
                <div class="prop b1">
                    <h2>Multas Aplicadas</h2>
                    <ul>
                        {% for multa in multas %}
                            <li>Fecha: {{ multa.fecha }}, Apto: {{ multa.apto }}, Bloque: {{ multa.bloque }}, Multa: {{ multa.Multa }}</li>
                        {% endfor %}
                    </ul>
                </div>
                
                <div class="prop b2">
                    <h2>Intereses Aplicados</h2>
                    <ul>
                        {% for interes in intereses %}
                            <li>Fecha: {{ interes.fecha }}, Apto: {{ interes.apto }}, Bloque: {{ interes.bloque }}, Interes: {{ interes.Interes }}</li>
                        {% endfor %}
                    </ul>
                </div>
                </div>                              
            </div>
        </div>
    </main>

    <!-- Formulario emergente para editar datos del propietario -->
    <div id="editarPropietarioModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="cerrarModalEditarPropietario()">&times;</span>
            <h2>Editar Cobros</h2>
            <form id="formularioEditarPropietario" method="POST" action="/actualizar_cobros">
                <!-- Campos ocultos para enviar el user_id y los nuevos valores -->
                <input type="hidden" id="user_id" name="user_id">
                <label for="valoradmin">Valor de Administración:</label> <!-- Campo Admin -->
                <input type="text" id="valoradmin" name="valoradmin">
                <label for="valorparq">Valor de Parqueadero:</label> <!-- Campo Parq -->
                <input type="text" id="valorparq" name="valorparq">
                <label for="cuotaextra">Valor de Cuota Extra:</label> <!-- Campo cuota extra-->
                <input type="text" id="cuotaextra" name="cuotaextra">
                <button class="boton" type="submit" onclick="guardarCambios()">Guardar Cambios</button>
            </form>
        </div>
    </div>

    <!-- Modal para añadir multa -->
    <div id="añadirMultaModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="cerrarModalAñadirMulta()">&times;</span>
            <h2>Añadir Multa</h2>
            <!-- Aquí iría el formulario para añadir la multa -->
            <form id="formularioAñadirMulta" method="POST" action="/añadir_multa">
                <!-- Campos del formulario para añadir la multa -->
                <input type="hidden" id="user_id_multa" name="user_id">
                <label for="monto_multa">Monto de la Multa:</label>
                <input type="text" id="monto_multa" name="monto">
                <button class="boton" type="submit" onclick="guardarMulta()">Guardar Multa</button>
            </form>
        </div>
    </div>

    <section class="sidebar">
        <div class="menu">
            <a href="/estadisticas/{{ edificio_id }}" class="enlace">
                <i class="fas fa-chart-pie"></i>
                <span>Estadísticas</span>
            </a>                     
            <a href="/propietarios/{{ edificio_id }}" class="enlace">
                <i class="fas fa-home"></i>
                <span>Propietarios</span>
            </a>
            <a href="" class="enlace activo">
                <i class="fas fa-money-check-alt"></i>
                <span>Cobros</span>
            </a>
            <a href="/contabilidad/{{ edificio_id }}" class="enlace">
                <i class="fas fa-book"></i>
                <span>Contabilidad</span>
            </a>
            <a href="/informes/{{ edificio_id }}" class="enlace">
                <i class="fas fa-file-alt"></i>
                <span>Informes</span>
            </a>
            <a href="/configuracion/{{ edificio_id }}" class="enlace">
                <i class="fas fa-cogs"></i>
                <span>Configuración</span>
            </a>            

            <div class="enlace" onclick="webdomotycort()">
                <i class="fas fa-globe"></i>
                <span>Nosotros</span>
            </div>
            <div class="cerrar">
                <a href="{{ url_for('logout') }}">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Cerrar Sesión</span>
                </a>
            </div>
        </div>
    </section>

    <script>

        // Función para mostrar automáticamente los detalles del bloque 1 al cargar la página
        window.onload = function () {
            togglePropietarios(1);
        }

        function togglePropietarios(bloque) {
            // Ocultar los detalles de todos los bloques excepto el bloque seleccionado
            var bloques = document.querySelectorAll('.bloque');
            for (var i = 0; i < bloques.length; i++) {
                if (bloques[i].id === 'bloque' + bloque) {
                    bloques[i].style.display = 'block';
                } else {
                    bloques[i].style.display = 'none';
                }
            }
        }

        function abrirModalEditarPropietario(user_id, valoradmin, valorparq, cuotaextra) {
            var modal = document.getElementById("editarPropietarioModal");
            var form = document.getElementById("formularioEditarPropietario");
        
            // Llenar los campos del formulario con los datos del propietario a editar
            document.getElementById("user_id").value = user_id;
            document.getElementById("valoradmin").value = valoradmin; // Establecer el valor del campo "Admin"
            document.getElementById("valorparq").value = valorparq; // Establecer el valor del campo "Parq"
            document.getElementById("cuotaextra").value = cuotaextra; // Establecer el valor del campo "Parq"
        
            // Mostrar el modal
            modal.style.display = "block";
        }
        function guardarCambios() {
            // Cerrar el modal
            cerrarModalEditarPropietario();
            // Mostrar mensaje de confirmación
            alert("Los cambios se realizarán una vez que se actualice la página.");
        }
        // Función para cerrar el modal de edición del propietario
        function cerrarModalEditarPropietario() {
            var modal = document.getElementById("editarPropietarioModal");
            modal.style.display = "none";
        }



        // Función para abrir el modal para añadir multa
        function abrirModalAñadirMulta(user_id) {
            var modal = document.getElementById("añadirMultaModal");
            // Aquí podrías agregar lógica adicional para buscar al propietario antes de abrir el modal
            document.getElementById("user_id_multa").value = user_id; // Establece el user_id en el formulario
            modal.style.display = "block";
        }

        // Función para cerrar el modal para añadir multa
        function cerrarModalAñadirMulta() {
            var modal = document.getElementById("añadirMultaModal");
            modal.style.display = "none";
        }

        // Función para guardar la multa
        function guardarMulta() {
            // Aquí podrías agregar la lógica para enviar el formulario y guardar la multa en el servidor
            cerrarModalAñadirMulta();
            alert("La multa se guardará una vez que se actualice la página.");
        }



        // Función para actualizar ambas gráficas

        function webdomotycort() {
            var url = 'https://yomar009.github.io/domyclip/';
            window.open(url, '_blank');
        }
        function cambiarPestana(pestaña) {
            window.location.href = `/dashboard/${nombre_edificio}/${pestaña}`;
        }
    </script>
</body>

</html>